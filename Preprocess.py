#!/usr/bin/python
from Config import *
from zipfile import ZipFile
from os import listdir,chdir,getcwd
from shutil import rmtree as removeFolder
import FeatureExtract
from pickle import dump

class Preprocess:
	
	def __init__(self):
		self.__parseAllRawApks()
	
	def __parseAllRawApks(self):
		antPath = getcwd()
		raw_train_samples = []
		raw_test_samples  = []
		
		## RAW_TEST_MALWARE #
		print "Preprocessing raw_test_malware..."
		for zapk in listdir(PATH_RAW_TEST_MALWARE_SAMPLES):
			self.__extractApk(PATH_RAW_TEST_MALWARE_SAMPLES,zapk)		
			chdir(PATH_RAW_TEST_MALWARE_SAMPLES+zapk[0:-4])
			raw_test_samples.append(FeatureExtract.FeatureExtract._featureExtract())
			chdir(antPath)
			removeFolder(PATH_RAW_TEST_MALWARE_SAMPLES+zapk[0:-4])
		
		## RAW_TEST_NO_MALWARE ##
		print "Preprocessing raw_test_no_malware..."
		for zapk in listdir(PATH_RAW_TEST_NO_MALWARE_SAMPLES):
			self.__extractApk(PATH_RAW_TEST_NO_MALWARE_SAMPLES,zapk)		
			chdir(PATH_RAW_TEST_NO_MALWARE_SAMPLES+zapk[0:-4])
			raw_test_samples.append(FeatureExtract.FeatureExtract._featureExtract())
			chdir(antPath)
			removeFolder(PATH_RAW_TEST_NO_MALWARE_SAMPLES+zapk[0:-4])
			
		## RAW_TRAIN_MALWARE ##
		print "Preprocessing raw_train_malware..."
		for zapk in listdir(PATH_RAW_TRAIN_MALWARE_SAMPLES):
			self.__extractApk(PATH_RAW_TRAIN_MALWARE_SAMPLES,zapk)		
			chdir(PATH_RAW_TRAIN_MALWARE_SAMPLES+zapk[0:-4])
			raw_train_samples.append((FeatureExtract.FeatureExtract._featureExtract(),1))
			chdir(antPath)
			removeFolder(PATH_RAW_TRAIN_MALWARE_SAMPLES+zapk[0:-4])
		
		## RAW_TRAIN_NO_MALWARE ##
		print "Preprocessing raw_train__no_malware..."
		for zapk in listdir(PATH_RAW_TRAIN_NO_MALWARE_SAMPLES):
			self.__extractApk(PATH_RAW_TRAIN_NO_MALWARE_SAMPLES,zapk)		
			chdir(PATH_RAW_TRAIN_NO_MALWARE_SAMPLES+zapk[0:-4])
			raw_train_samples.append((FeatureExtract.FeatureExtract._featureExtract(),0))
			chdir(antPath)
			removeFolder(PATH_RAW_TRAIN_NO_MALWARE_SAMPLES+zapk[0:-4])
		
		print "**** Test samples ****\n\n",raw_test_samples
		print "\n\n**** Train samples ****\n\n",raw_train_samples
		with open(:
			
	def __extractApk(self,folder,name):
		with ZipFile(folder+name,"r") as zapk:
			zapk.extractall(folder+name[0:-4])
			
			
if __name__ == "__main__":
	Preprocess()

